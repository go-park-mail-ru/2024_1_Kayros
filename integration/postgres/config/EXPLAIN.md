# Homework 2

### Как мы обеспечиваем валидацию ?
1. Валидируем тела POST-запросов с помощью валидирующих тегов ([Пример тут](https://github.com/asaskevich/govalidator)).
2. Используем санитайзер от XSS-атак.
3. Экранируем переменные данные в SQL-запросах к базе данных.
4. Используем экранирование в паре с Prepared Statements.

При проверке с помощью sqlmap уязывимые моменты не были обнаружены ([Ссылка на asciinema](https://asciinema.org/a/Eao9ZhRAt2pfUpU6gsmEGlSg3)). 

### Пулл соединений и параметры соединений
`
  db.SetMaxOpenConns(int(dbConfig.MaxOpenConns))                 
  db.SetConnMaxLifetime(time.Duration(dbConfig.ConnMaxLifetime) * time.Second)
  db.SetMaxIdleConns(int(dbConfig.MaxIdleConns))
  db.SetConnMaxIdleTime(time.Duration(dbConfig.ConnMaxIdleTime) * time.Second)
`

В конфигурационном файле следующие значения параметров:
`
  max-open-connections: 10  
  conn-max-lifetime: 30
  max-idle-conns: 9
  conn-max-idle-time: 15
`

Наша приложение не подвергается большим нагрузкам, поэтому 10 открытых соединений будет достаточно дял конкуретного доступа к БД. В файлу `postgresql.conf` содержится базовая настройка postgresql. 

В `listen_addresses` указаны ip-адреса контейнеров, которым необходимо общаться с БД, а также `127.0.0.1`, чтобы можно было с консоли подключиться к БД. Все это достаточно безопасно, поскольку злоумышленник не сможет со своего ПК обратиться к БД.

### Настройка параметров сервера и клиента

`statement_timeout = 3s` - это максимальное время, которое можно заставить ждать клиента (учитываем еще lock_timeout). Больший временной промежуток заставит клиента нервничать, что нам не надо, поскольку мы хотим презентовать себя как нормальный работающий сервис. Да и от DOS-атак это в некотором смысле обезопасит, потому что 10 открытых соединий не уснут на минуту, а разблокируются спустя 3 секунды.

`lock_timeout = 1s` - в работе все-таки может оказатсья очередь на ожидание, и таймаут в одну секунду кажется более менее подходящим, хотя захватит при большой нагрузке не все запросы, но работая в штатном режиме, бекенд будет успешно укладываться в 1 секунду, да и метрики, собранные prometheus-ом говорят об этом.

Логирование медленных запросов также было подключено.